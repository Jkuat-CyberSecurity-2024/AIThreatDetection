{% extends "dashboard/base_dashboard.html" %}
{% block content %}
<style>
    .dashboard-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 60px); /* Adjust based on your header/footer height */
        padding: 20px;
        gap: 20px;
    }

    .section {
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        flex: 1;
    }

    .section h1, .section h2 {
        background-color: #1b5e20;
        color: white;
        margin: 0;
        padding: 15px 20px;
        font-size: 1.5rem;
    }

    .table-container {
        overflow: auto;
        flex: 1;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }

    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }

    thead {
        background-color: #f1f8e9;
        position: sticky;
        top: 0;
        z-index: 1;
    }

    th {
        font-weight: bold;
        color: #2e7d32;
    }

    tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .anomaly {
        background-color: #ffebee !important;
    }

    .tooltip {
        position: relative;
        display: inline-block;
        cursor: pointer;
        color: #d32f2f;
        font-weight: bold;
    }

    .tooltip .tooltip-text {
        visibility: hidden;
        width: 200px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -100px;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
    }

    @media (max-width: 768px) {
        .dashboard-container {
            height: auto;
        }

        .section {
            height: 50vh;
        }

        th, td {
            padding: 8px;
            font-size: 0.8rem;
        }
    }
</style>

<div class="dashboard-container">
    <div class="section" id="logs">
        <h1>Access Logs</h1>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>IP Address</th>
                        <th>Timestamp</th>
                        <th>Method</th>
                        <th>Resource</th>
                        <th>Protocol</th>
                        <th>Status Code</th>
                        <th>Source Port</th>
                        <th>Destination Port</th>
                        <th>Origin Server</th>
                        <th>Destination</th>
                        <th>Response Code</th>
                        <th>Response Time</th>
                        <th>Backend Time</th>
                        <th>Anomaly Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in access_logs %}
                    <tr class="{% if log.anomaly %}anomaly{% endif %}">
                        <td>{{ log.ip_address }}</td>
                        <td>{{ log.timestamp }}</td>
                        <td>{{ log.method }}</td>
                        <td>{{ log.resource }}</td>
                        <td>{{ log.protocol }}</td>
                        <td>{{ log.status_code }}</td>
                        <td>{{ log.source_port }}</td>
                        <td>{{ log.destination_port }}</td>
                        <td>{{ log.origin_server }}</td>
                        <td>{{ log.destination }}</td>
                        <td>{{ log.response_code }}</td>
                        <td>{{ log.response_time }}</td>
                        <td>{{ log.backend_time }}</td>
                        <td>
                            {% if log.anomaly %}
                                <span class="tooltip">Anomaly
                                    <span class="tooltip-text">Detected as potential threat</span>
                                </span>
                            {% else %}
                                Normal
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="section" id="anomalies">
        <h2>Anomalies in the System</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>IP Address</th>
                        <th>Timestamp</th>
                        <th>Anomaly Details</th>
                        <th>Feedback</th>
                        <th>Reviewed</th>
                    </tr>
                </thead>
                <tbody>
                    {% for anomaly in anomalies.values %}
                    <tr>
                        <td>{{ anomaly.ip_address }}</td>
                        <td>{{ anomaly.timestamp }}</td>
                        <td>{{ anomaly.anomaly_data }}</td>
                        <td>{{ anomaly.feedback|default:"Not Reviewed" }}</td>
                        <td>{{ anomaly.reviewed|yesno:"Yes,No" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}